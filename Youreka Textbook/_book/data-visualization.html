<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Data visualization | A Gentle Introduction to Data Science with R</title>
  <meta name="description" content="Description here" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Data visualization | A Gentle Introduction to Data Science with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Description here" />
  <meta name="github-repo" content="tig3r66/youreka-textbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Data visualization | A Gentle Introduction to Data Science with R" />
  
  <meta name="twitter:description" content="Description here" />
  

<meta name="author" content="Youreka Canada" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="comparing-multiple-means.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Youreka Canada</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-this-textbook"><i class="fa fa-check"></i>How to use this textbook</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#credit"><i class="fa fa-check"></i>Credit</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="part"><span><b>I Prerequisites</b></span></li>
<li class="chapter" data-level="1" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>1</b> Install R and RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="install.html"><a href="install.html#r-and-rstudio"><i class="fa fa-check"></i><b>1.1</b> R and RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html"><i class="fa fa-check"></i><b>2</b> Basics of R and RStudio</a><ul>
<li class="chapter" data-level="2.1" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#objects"><i class="fa fa-check"></i><b>2.1</b> Objects</a></li>
<li class="chapter" data-level="2.2" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a></li>
<li class="chapter" data-level="2.3" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#working-directory"><i class="fa fa-check"></i><b>2.3</b> Working directory</a><ul>
<li class="chapter" data-level="2.3.1" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#other-important-things"><i class="fa fa-check"></i><b>2.3.1</b> Other important things</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#basic-math-in-r"><i class="fa fa-check"></i><b>2.4</b> Basic math in R</a></li>
<li class="chapter" data-level="2.5" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#data-structures-in-r"><i class="fa fa-check"></i><b>2.5</b> Data structures in R</a><ul>
<li class="chapter" data-level="2.5.1" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#vectors"><i class="fa fa-check"></i><b>2.5.1</b> Vectors</a></li>
<li class="chapter" data-level="2.5.2" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#missing-values-na"><i class="fa fa-check"></i><b>2.5.2</b> Missing values (NA)</a></li>
<li class="chapter" data-level="2.5.3" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#working-with-multiple-vectors"><i class="fa fa-check"></i><b>2.5.3</b> Working with multiple vectors</a></li>
<li class="chapter" data-level="2.5.4" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#data-frames"><i class="fa fa-check"></i><b>2.5.4</b> Data frames</a></li>
<li class="chapter" data-level="2.5.5" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#reading-in-external-data"><i class="fa fa-check"></i><b>2.5.5</b> Reading in external data</a></li>
<li class="chapter" data-level="2.5.6" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#factors"><i class="fa fa-check"></i><b>2.5.6</b> Factors</a></li>
<li class="chapter" data-level="2.5.7" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#lists"><i class="fa fa-check"></i><b>2.5.7</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#conditionals"><i class="fa fa-check"></i><b>2.6</b> Conditionals</a><ul>
<li class="chapter" data-level="2.6.1" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#conditional-basics"><i class="fa fa-check"></i><b>2.6.1</b> Conditional basics</a></li>
<li class="chapter" data-level="2.6.2" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#if-statements"><i class="fa fa-check"></i><b>2.6.2</b> <code>if</code> statements</a></li>
<li class="chapter" data-level="2.6.3" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#multiple-ifs-vs-else-if"><i class="fa fa-check"></i><b>2.6.3</b> Multiple <code>if</code>s vs <code>else if</code></a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#for-loops"><i class="fa fa-check"></i><b>2.7</b> <code>for</code> loops</a><ul>
<li class="chapter" data-level="2.7.1" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#basic-for-loop"><i class="fa fa-check"></i><b>2.7.1</b> Basic <code>for</code> loop</a></li>
<li class="chapter" data-level="2.7.2" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#looping-with-an-index-storing-results"><i class="fa fa-check"></i><b>2.7.2</b> Looping with an index &amp; storing results</a></li>
<li class="chapter" data-level="2.7.3" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#looping-over-files-optional"><i class="fa fa-check"></i><b>2.7.3</b> Looping over files (OPTIONAL)</a></li>
<li class="chapter" data-level="2.7.4" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#subsetting-data-optional"><i class="fa fa-check"></i><b>2.7.4</b> Subsetting data (OPTIONAL)</a></li>
<li class="chapter" data-level="2.7.5" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#nested-loops-optional"><i class="fa fa-check"></i><b>2.7.5</b> Nested loops (OPTIONAL)</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#functions-1"><i class="fa fa-check"></i><b>2.8</b> Functions</a><ul>
<li class="chapter" data-level="2.8.1" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#function-basics"><i class="fa fa-check"></i><b>2.8.1</b> Function basics</a></li>
<li class="chapter" data-level="2.8.2" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#conditionals-within-functions"><i class="fa fa-check"></i><b>2.8.2</b> Conditionals within functions</a></li>
<li class="chapter" data-level="2.8.3" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#nested-conditionals-optional"><i class="fa fa-check"></i><b>2.8.3</b> Nested conditionals (OPTIONAL)</a></li>
<li class="chapter" data-level="2.8.4" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#default-arguments-and-unnamed-arguments"><i class="fa fa-check"></i><b>2.8.4</b> Default arguments and unnamed arguments</a></li>
<li class="chapter" data-level="2.8.5" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#combining-functions-optional"><i class="fa fa-check"></i><b>2.8.5</b> Combining functions (OPTIONAL)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Data Wrangling</b></span></li>
<li class="chapter" data-level="3" data-path="basics-of-r-and-rstudio.html"><a href="basics-of-r-and-rstudio.html#data-frames"><i class="fa fa-check"></i><b>3</b> Data frames</a><ul>
<li class="chapter" data-level="3.1" data-path="data-frames.html"><a href="data-frames.html"><i class="fa fa-check"></i><b>3.1</b> Get the gapminder data</a></li>
<li class="chapter" data-level="3.2" data-path="data-frames.html"><a href="data-frames.html#explore-gapminder"><i class="fa fa-check"></i><b>3.2</b> Explore gapminder</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-frames.html"><a href="data-frames.html#importing-and-exporting-data"><i class="fa fa-check"></i><b>3.2.1</b> Importing and exporting data</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-frames.html"><a href="data-frames.html#exploring-variables-in-a-data-frame"><i class="fa fa-check"></i><b>3.2.2</b> Exploring variables in a data Frame</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-frames.html"><a href="data-frames.html#plotting-variables-with-r-optional"><i class="fa fa-check"></i><b>3.2.3</b> Plotting variables with R (OPTIONAL)</a></li>
<li class="chapter" data-level="3.2.4" data-path="data-frames.html"><a href="data-frames.html#data-frame-summary"><i class="fa fa-check"></i><b>3.2.4</b> Data frame summary</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-frames.html"><a href="data-frames.html#data-frames-with-dplyr"><i class="fa fa-check"></i><b>3.3</b> Data frames with dplyr</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-frames.html"><a href="data-frames.html#subsetting-the-data"><i class="fa fa-check"></i><b>3.3.1</b> Subsetting the data</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-frames.html"><a href="data-frames.html#filter-rows-with-filter"><i class="fa fa-check"></i><b>3.3.2</b> Filter rows with <code>filter()</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="data-frames.html"><a href="data-frames.html#pipe-operator"><i class="fa fa-check"></i><b>3.3.3</b> Pipe operator <code>%&gt;%</code></a></li>
<li class="chapter" data-level="3.3.4" data-path="data-frames.html"><a href="data-frames.html#select-columns-with-select"><i class="fa fa-check"></i><b>3.3.4</b> Select Columns with <code>select()</code></a></li>
<li class="chapter" data-level="3.3.5" data-path="data-frames.html"><a href="data-frames.html#pure-predictable-pipeable-optional"><i class="fa fa-check"></i><b>3.3.5</b> Pure, predictable, pipeable (OPTIONAL)</a></li>
<li class="chapter" data-level="3.3.6" data-path="data-frames.html"><a href="data-frames.html#additional-resources"><i class="fa fa-check"></i><b>3.3.6</b> Additional resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="more-dplyr.html"><a href="more-dplyr.html"><i class="fa fa-check"></i><b>4</b> More dplyr</a><ul>
<li class="chapter" data-level="4.1" data-path="more-dplyr.html"><a href="more-dplyr.html#review-and-preparation"><i class="fa fa-check"></i><b>4.1</b> Review and preparation</a><ul>
<li class="chapter" data-level="4.1.1" data-path="data-frames.html"><a href="data-frames.html#load-dplyr-and-gapminder"><i class="fa fa-check"></i><b>4.1.1</b> Load <code>dplyr</code> and gapminder</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="more-dplyr.html"><a href="more-dplyr.html#use-mutate-to-add-new-variables"><i class="fa fa-check"></i><b>4.2</b> Use mutate() to add new variables</a></li>
<li class="chapter" data-level="4.3" data-path="more-dplyr.html"><a href="more-dplyr.html#use-arrange-to-row-order-data"><i class="fa fa-check"></i><b>4.3</b> Use arrange() to row-order data</a></li>
<li class="chapter" data-level="4.4" data-path="more-dplyr.html"><a href="more-dplyr.html#use-rename-to-rename-variables"><i class="fa fa-check"></i><b>4.4</b> Use rename() to rename variables</a><ul>
<li class="chapter" data-level="4.4.1" data-path="more-dplyr.html"><a href="more-dplyr.html#select-can-rename-and-reposition-variables"><i class="fa fa-check"></i><b>4.4.1</b> <code>select()</code> Can Rename and Reposition Variables</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="more-dplyr.html"><a href="more-dplyr.html#perform-tasks-on-subsets-with-group_by"><i class="fa fa-check"></i><b>4.5</b> Perform tasks on subsets with <code>group_by()</code></a><ul>
<li class="chapter" data-level="4.5.1" data-path="more-dplyr.html"><a href="more-dplyr.html#counting"><i class="fa fa-check"></i><b>4.5.1</b> Counting</a></li>
<li class="chapter" data-level="4.5.2" data-path="more-dplyr.html"><a href="more-dplyr.html#general-summarization"><i class="fa fa-check"></i><b>4.5.2</b> General summarization</a></li>
<li class="chapter" data-level="4.5.3" data-path="more-dplyr.html"><a href="more-dplyr.html#computing-with-group-wise-summaries"><i class="fa fa-check"></i><b>4.5.3</b> Computing with group-wise summaries</a></li>
<li class="chapter" data-level="4.5.4" data-path="more-dplyr.html"><a href="more-dplyr.html#window-functions-optional"><i class="fa fa-check"></i><b>4.5.4</b> Window functions (OPTIONAL)</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="more-dplyr.html"><a href="more-dplyr.html#introduction-to-visualization-optional"><i class="fa fa-check"></i><b>4.6</b> Introduction to visualization (OPTIONAL)</a></li>
<li class="chapter" data-level="4.7" data-path="more-dplyr.html"><a href="more-dplyr.html#comprehensive-practice-optional"><i class="fa fa-check"></i><b>4.7</b> Comprehensive practice (OPTIONAL)</a></li>
<li class="chapter" data-level="4.8" data-path="more-dplyr.html"><a href="more-dplyr.html#summary"><i class="fa fa-check"></i><b>4.8</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>III Statistics</b></span></li>
<li class="chapter" data-level="5" data-path="central-limit-theorem.html"><a href="central-limit-theorem.html"><i class="fa fa-check"></i><b>5</b> Central limit theorem</a><ul>
<li class="chapter" data-level="5.1" data-path="central-limit-theorem.html"><a href="central-limit-theorem.html#central-limit-theorem-for-means"><i class="fa fa-check"></i><b>5.1</b> Central limit theorem for means</a></li>
<li class="chapter" data-level="5.2" data-path="central-limit-theorem.html"><a href="central-limit-theorem.html#central-limit-theorem-for-probability-optional"><i class="fa fa-check"></i><b>5.2</b> Central limit theorem for probability (OPTIONAL)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html"><i class="fa fa-check"></i><b>6</b> Basic statistical tests</a><ul>
<li class="chapter" data-level="6.1" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#getting-ready"><i class="fa fa-check"></i><b>6.1</b> Getting ready</a></li>
<li class="chapter" data-level="6.2" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#students-t-test"><i class="fa fa-check"></i><b>6.2</b> Student’s t-test</a></li>
<li class="chapter" data-level="6.3" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#chi-squared-test"><i class="fa fa-check"></i><b>6.3</b> Chi-squared test</a><ul>
<li class="chapter" data-level="6.3.1" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#chi2-test-for-goodness-of-fit"><i class="fa fa-check"></i><b>6.3.1</b> <span class="math inline">\(\chi^2\)</span> test for goodness-of-fit</a></li>
<li class="chapter" data-level="6.3.2" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#chi2-test-for-independence"><i class="fa fa-check"></i><b>6.3.2</b> <span class="math inline">\(\chi^2\)</span> test for independence</a></li>
<li class="chapter" data-level="6.3.3" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#chi2-test-for-homogeneity"><i class="fa fa-check"></i><b>6.3.3</b> <span class="math inline">\(\chi^2\)</span> test for homogeneity</a></li>
<li class="chapter" data-level="6.3.4" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#fishers-exact-test-optional"><i class="fa fa-check"></i><b>6.3.4</b> Fisher’s exact test (OPTIONAL)</a></li>
<li class="chapter" data-level="6.3.5" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#comparison-of-proportions-optional"><i class="fa fa-check"></i><b>6.3.5</b> Comparison of proportions (OPTIONAL)</a></li>
<li class="chapter" data-level="6.3.6" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#contingency-tables"><i class="fa fa-check"></i><b>6.3.6</b> Contingency tables</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="basic-statistical-tests.html"><a href="basic-statistical-tests.html#visualizing-data-distributions-optional"><i class="fa fa-check"></i><b>6.4</b> Visualizing data distributions (OPTIONAL)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html"><i class="fa fa-check"></i><b>7</b> Comparing multiple means</a><ul>
<li class="chapter" data-level="7.1" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#loading-packages"><i class="fa fa-check"></i><b>7.1</b> Loading packages</a></li>
<li class="chapter" data-level="7.2" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#merging-datasets"><i class="fa fa-check"></i><b>7.2</b> Merging datasets</a></li>
<li class="chapter" data-level="7.3" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#one-way-anova"><i class="fa fa-check"></i><b>7.3</b> One-way ANOVA</a><ul>
<li class="chapter" data-level="7.3.1" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#the-iris-dataset"><i class="fa fa-check"></i><b>7.3.1</b> The iris dataset</a></li>
<li class="chapter" data-level="7.3.2" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#non-parametric-alternatives-to-anova"><i class="fa fa-check"></i><b>7.3.2</b> Non-parametric alternatives to ANOVA</a></li>
<li class="chapter" data-level="7.3.3" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#two-way-anova"><i class="fa fa-check"></i><b>7.3.3</b> Two-way ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#linear-regression"><i class="fa fa-check"></i><b>7.4</b> Linear regression</a><ul>
<li class="chapter" data-level="7.4.1" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#basic-concepts"><i class="fa fa-check"></i><b>7.4.1</b> Basic concepts</a></li>
<li class="chapter" data-level="7.4.2" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#pearson-correlation"><i class="fa fa-check"></i><b>7.4.2</b> Pearson correlation</a></li>
<li class="chapter" data-level="7.4.3" data-path="comparing-multiple-means.html"><a href="comparing-multiple-means.html#spearman-correlation"><i class="fa fa-check"></i><b>7.4.3</b> Spearman correlation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-visualization.html"><a href="data-visualization.html"><i class="fa fa-check"></i><b>8</b> Data visualization</a><ul>
<li class="chapter" data-level="8.1" data-path="data-visualization.html"><a href="data-visualization.html#a-graphing-template"><i class="fa fa-check"></i><b>8.1</b> A graphing template</a></li>
<li class="chapter" data-level="8.2" data-path="data-visualization.html"><a href="data-visualization.html#scatter-plot"><i class="fa fa-check"></i><b>8.2</b> Scatter plot</a><ul>
<li class="chapter" data-level="8.2.1" data-path="data-visualization.html"><a href="data-visualization.html#trend-lines"><i class="fa fa-check"></i><b>8.2.1</b> Trend lines</a></li>
<li class="chapter" data-level="8.2.2" data-path="data-visualization.html"><a href="data-visualization.html#facets"><i class="fa fa-check"></i><b>8.2.2</b> Facets</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-visualization.html"><a href="data-visualization.html#aesthetic-mappings"><i class="fa fa-check"></i><b>8.3</b> Aesthetic mappings</a></li>
<li class="chapter" data-level="8.4" data-path="data-visualization.html"><a href="data-visualization.html#line-plot"><i class="fa fa-check"></i><b>8.4</b> Line plot</a></li>
<li class="chapter" data-level="8.5" data-path="data-visualization.html"><a href="data-visualization.html#bar-plot"><i class="fa fa-check"></i><b>8.5</b> Bar plot</a><ul>
<li class="chapter" data-level="8.5.1" data-path="data-visualization.html"><a href="data-visualization.html#basics"><i class="fa fa-check"></i><b>8.5.1</b> Basics</a></li>
<li class="chapter" data-level="8.5.2" data-path="data-visualization.html"><a href="data-visualization.html#plotting-significance-optional"><i class="fa fa-check"></i><b>8.5.2</b> Plotting significance (OPTIONAL)</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="data-visualization.html"><a href="data-visualization.html#box-plot"><i class="fa fa-check"></i><b>8.6</b> Box plot</a></li>
<li class="chapter" data-level="8.7" data-path="data-visualization.html"><a href="data-visualization.html#histogram-and-density-plot"><i class="fa fa-check"></i><b>8.7</b> Histogram and density plot</a></li>
<li class="chapter" data-level="8.8" data-path="data-visualization.html"><a href="data-visualization.html#assembly-of-multiple-figures-optional"><i class="fa fa-check"></i><b>8.8</b> Assembly of multiple figures (OPTIONAL)</a></li>
<li class="chapter" data-level="8.9" data-path="data-visualization.html"><a href="data-visualization.html#extras-optional"><i class="fa fa-check"></i><b>8.9</b> Extras (OPTIONAL)</a><ul>
<li class="chapter" data-level="8.9.1" data-path="data-visualization.html"><a href="data-visualization.html#choropleth"><i class="fa fa-check"></i><b>8.9.1</b> Choropleth</a></li>
<li class="chapter" data-level="8.9.2" data-path="data-visualization.html"><a href="data-visualization.html#animations"><i class="fa fa-check"></i><b>8.9.2</b> Animations</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="data-frames.html"><a href="data-frames.html#additional-resources"><i class="fa fa-check"></i><b>8.10</b> Additional resources</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Gentle Introduction to Data Science with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-visualization" class="section level1">
<h1><span class="header-section-number">8</span> Data visualization</h1>
<blockquote>
<p>“The simple graph has brought more information to the data analyst’s mind than any other device.” – John Tukey</p>
</blockquote>
<p>This lab is all about preparing publication-ready figures with <code>ggplot2</code> and related packages. <code>ggplot2</code> uses elegant syntax and it implements <a href="http://vita.had.co.nz/papers/layered-grammar.pdf">“The Layered Grammar of Graphics”</a>.</p>
<p>Before we begin, let’s review a few key points for good figures:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Be clear and avoid confusion</strong>. Presenting too much information often results in messy figures. Figures inconsistent in colour, symbols, etc. can easily confuse readers.</p></li>
<li><p><strong>Only use additional aesthetic effects when necessary.</strong> Everything in a graph has a purpose. The primary objective of a figure is to inform, not to look fancy (though this is a plus). When in doubt, stick to black, white, and grey.</p></li>
<li><p><strong>Only use texts when necessary.</strong> Make text large. Never use Comic Sans as your font. Sans serif fonts such as Arial and Calibri are usually good bets.</p></li>
</ol>
<p><strong>Key point:</strong> the plot depends on the variables. Some plots are more appropriate for visualization than others. You have an obligation to display data responsibly. Check out <a href="https://www.r-graph-gallery.com/index.html">The R Graph Gallery</a> for a “dictionary” on different visualizations and the code to create them.</p>
<p>Recall that the <code>tidyverse</code> contains <code>ggplot2</code> and <code>dplyr</code> among other packages. We’ll also load <code>gapminder</code>.</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb596-1" data-line-number="1"><span class="kw">library</span>(gapminder)</a>
<a class="sourceLine" id="cb596-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<p>Hopefully by now you have a good idea of what the <code>gapminder</code> dataset looks like. Here’s a quick refresher:</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb597-1" data-line-number="1"><span class="kw">head</span>(gapminder)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   country     continent  year lifeExp      pop gdpPercap
##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1 Afghanistan Asia       1952    28.8  8425333      779.
## 2 Afghanistan Asia       1957    30.3  9240934      821.
## 3 Afghanistan Asia       1962    32.0 10267083      853.
## 4 Afghanistan Asia       1967    34.0 11537966      836.
## 5 Afghanistan Asia       1972    36.1 13079460      740.
## 6 Afghanistan Asia       1977    38.4 14880372      786.</code></pre>
<div id="a-graphing-template" class="section level2">
<h2><span class="header-section-number">8.1</span> A graphing template</h2>
<p>Although we’ve presented graphs with <code>ggplot2</code> in previous labs, let’s delve into the specifics of the syntax:</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb599-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="op">&lt;</span>DATA<span class="op">&gt;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb599-2" data-line-number="2"><span class="st">  </span><span class="er">&lt;</span>GEOM_FUNCTION<span class="op">&gt;</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="op">&lt;</span>MAPPINGS<span class="op">&gt;</span>))</a></code></pre></div>
<p>Everything in the initial <code>ggplot()</code> function is passed into the subsequent functions (i.e., <code>GEOM_FUNCTION()</code>). When calling <code>ggplot()</code>, you don’t explicitly need to write <code>&lt;ARGUMENT&gt; =</code> (ex: <code>data = gapminder</code>, <code>x = lifeExp</code>) as long as you have the variables in the correct order – just be careful you don’t mix up <code>x</code> and <code>y</code>!</p>
<p><code>ggplot2</code> works in a layer-by-layer manner. Take a look at this:</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb600-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> pop, <span class="dt">y =</span> gdpPercap))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-250-1.png" width="672" /></p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb601-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> pop, <span class="dt">y =</span> gdpPercap)) <span class="op">+</span></a>
<a class="sourceLine" id="cb601-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-250-2.png" width="672" /></p>
<p>Here, the first line initializes the object and the second line adds a layer of scatter points. Unlike plotting in base R, you don’t need to specify variables using the <code>$</code> operator – <code>ggplot2</code> is smart enough to call it automatically for you.</p>
<p>I’d like to bring your attention to the <code>+</code> operator. This is how you add layers to the ggplot. Use <code>+</code> liberally to reduce excessively long lines; breaking long commands at appropriate places makes your code much more readable.</p>
</div>
<div id="scatter-plot" class="section level2">
<h2><span class="header-section-number">8.2</span> Scatter plot</h2>
<p>Use the scatter plot when you want to see the relationship between two continuous variables.</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb602-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(gdpPercap, lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb602-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-251-1.png" width="672" /></p>
<p>You also can save the object as a variable. To show the figure, use the <code>show()</code> function or simply call the object by its name.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb603-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(gdpPercap, lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb603-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb603-3" data-line-number="3"><span class="kw">show</span>(p)  <span class="co"># method 1</span></a>
<a class="sourceLine" id="cb603-4" data-line-number="4">p        <span class="co"># also works</span></a></code></pre></div>
<p>This data might benefit using a log scale. You can either log-transform (<code>log(gdpPercap)</code>) or simply draw the x axis in log scale (<code>scale_x_log10()</code>).</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb604-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(gdpPercap, lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb604-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb604-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a>
<a class="sourceLine" id="cb604-4" data-line-number="4"><span class="kw">show</span>(p)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-253-1.png" width="672" /></p>
<div id="trend-lines" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Trend lines</h3>
<p>It seems that there exists a positive correlation between the two variables – you might want to add a trend line. Remember, <code>p</code> is the object of scatter plot with x in log. We can just build from here. This just goes to show the beauty of layered graphical syntax.</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb605-1" data-line-number="1">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-254-1.png" width="672" /></p>
<p>You find that R used ‘gam’ model as default. ‘gam’ is the generalized additive model. Without going into the mathematical details, you would expect a curve from gam.</p>
<p>What if I want a straight line (i.e., linear regression)? I would want a straight line to start with. Let’s start with a linear model (<code>lm</code>).</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb607-1" data-line-number="1">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;lm&#39;</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-255-1.png" width="672" /></p>
<p>We can also create a generalized linear model (<code>glm</code>). <code>glm</code> can be useful if your variables are not normally distributed.</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb609-1" data-line-number="1">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;glm&#39;</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-256-1.png" width="672" /></p>
<p>It appears that<code>lm</code> and <code>glm</code> don’t look too different.</p>
<p>Notice that <code>lm</code> has a little shaded region around it. This correspondends to the confidence interval of 1 standard error. To get rid of it, specify <code>se = FALSE</code>. While we’re at it, let’s change the colour of the line to red and decrease its thickness. Let’s also remove that pesky grey background:</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb611-1" data-line-number="1">scatter_trend &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st">         </span><span class="co"># removes grey background</span></a>
<a class="sourceLine" id="cb611-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;lm&#39;</span>,</a>
<a class="sourceLine" id="cb611-3" data-line-number="3">                <span class="dt">se =</span> F,       <span class="co"># remove confidence band</span></a>
<a class="sourceLine" id="cb611-4" data-line-number="4">                <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>,  <span class="co"># change colour of line to red (hex colours also work: #FF0000)</span></a>
<a class="sourceLine" id="cb611-5" data-line-number="5">                <span class="dt">size =</span> <span class="fl">0.75</span>)  <span class="co"># set width of line</span></a>
<a class="sourceLine" id="cb611-6" data-line-number="6"><span class="kw">show</span>(scatter_trend)</a></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-257-1.png" width="672" /></p>
</div>
<div id="facets" class="section level3">
<h3><span class="header-section-number">8.2.2</span> Facets</h3>
<p>If you were paying careful attention, you may have noticed that we were using data from multiple years. However, this results in a messy, and potentially misleading, graph. Let’s fix this by plotting each year separately with the facet feature.</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb613-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb613-2" data-line-number="2"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(year), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb613-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb613-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb613-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_bw</span>()  <span class="co"># another ggplot2 theme</span></a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-258-1.png" width="672" /></p>
<p>We can use faceting to split by the combination of two variables. Here I will use facet_grid to put the same values of splitting variables on the same row/column. Note that you also need to specify <code>vars(year)</code> and <code>vars(continent)</code> instead of just <code>year</code> and <code>continent</code>. This is simply to help <code>ggplot</code> retrieve the levels in a particular column.</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb614-1" data-line-number="1">gap.<span class="dv">52</span>.<span class="fl">77.07</span> &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1952</span>, <span class="dv">1977</span>, <span class="dv">2007</span>))</a>
<a class="sourceLine" id="cb614-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap.<span class="dv">52</span>.<span class="fl">77.07</span>, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb614-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">rows =</span> <span class="kw">vars</span>(year), <span class="dt">cols =</span> <span class="kw">vars</span>(continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb614-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb614-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb614-6" data-line-number="6"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-259-1.png" width="672" /></p>
</div>
</div>
<div id="aesthetic-mappings" class="section level2">
<h2><span class="header-section-number">8.3</span> Aesthetic mappings</h2>
<p>A scatter plot places dots using x and y coordinates. What if we want to show more detail, like which point(s) correspond to a particular group? For example, what if we want to see how life expectancy vs GDP per capita varies per continent in 1977?</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb615-1" data-line-number="1">gap<span class="fl">.77</span> &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">1977</span>)</a>
<a class="sourceLine" id="cb615-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap<span class="fl">.77</span>, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb615-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb615-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-260-1.png" width="672" /></p>
<p>You can see the points from some continents, like Europe and Africa, cluster at distinct positions.</p>
<p>In addition to adding colours to show (categorical or continuous) groupings, we can also use</p>
<ol style="list-style-type: decimal">
<li>Shape of points (categorical),</li>
<li>Size of points (continuous), or</li>
<li>Transparency/alpha of the points (continuous).</li>
</ol>
<p>These options are all specified within aesthetic mappings (<code>aes()</code>). That is, <code>aes()</code> is the place you specify how you present your variables. More specifically, it’s how you map your variables to various aesthetics. To repeat an earlier point, <code>aes()</code> within the <code>ggplot()</code> function applies to ALL layers, while those in other layers only applies to that specific layer.</p>
<p>Here’s another example. Be careful with this as R interprets <code>year</code> as a continuous variable. Use <code>as.factor()</code> or <code>factor()</code> to circumvent this issue,</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb616-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> gap.<span class="dv">52</span>.<span class="fl">77.07</span>, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb616-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">col =</span> <span class="kw">as.factor</span>(year))) <span class="op">+</span></a>
<a class="sourceLine" id="cb616-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-261-1.png" width="672" /></p>
<p>Going back to our original example of lifeExp vs gdpPercap by continent, I use <code>stat_elipse()</code> to enclose the points within a 95% confidence interval.</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb617-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">1977</span>), </a>
<a class="sourceLine" id="cb617-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb617-3" data-line-number="3"><span class="st">  </span><span class="co"># color only applies to the points, not the eclipses</span></a>
<a class="sourceLine" id="cb617-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb617-5" data-line-number="5"><span class="st">  </span><span class="co"># stat_ellipse uses level=0.95 by default</span></a>
<a class="sourceLine" id="cb617-6" data-line-number="6"><span class="st">  </span><span class="kw">stat_ellipse</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb617-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-262-1.png" width="672" /></p>
<p>We can also create multiple ellipses to group things together. Note that <code>color = continent</code> is the same as <code>colour = continent</code> and <code>col = continent</code>.</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb618-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">1977</span>), </a>
<a class="sourceLine" id="cb618-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">color =</span> continent)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb618-3" data-line-number="3"><span class="st">  </span><span class="co"># color applies to both points and eclipses</span></a>
<a class="sourceLine" id="cb618-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb618-5" data-line-number="5"><span class="st">  </span><span class="kw">stat_ellipse</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb618-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<pre><code>## Too few points to calculate an ellipse</code></pre>
<pre><code>## Warning: Removed 1 row(s) containing missing values (geom_path).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-263-1.png" width="672" /></p>
<p>What if we want to also visualize population size in addition to grouping by continent?</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb621-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">1977</span>), <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb621-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>continent, <span class="dt">size=</span>pop)) <span class="op">+</span></a>
<a class="sourceLine" id="cb621-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-264-1.png" width="672" /></p>
<p>Here we run into a minor problem: some dots are overlapping. We can fix this by applying <code>geom_jitter()</code> with partial transparency.</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb622-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">1977</span>), <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb622-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha=</span><span class="fl">0.7</span>, <span class="kw">aes</span>(<span class="dt">color=</span>continent, <span class="dt">size=</span>pop)) <span class="op">+</span></a>
<a class="sourceLine" id="cb622-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-265-1.png" width="672" /></p>
<p>Notice that <code>geom_jitter()</code> adds some random variation, or jitter, to each point. While this is a handy method to address overplotting, don’t rely on it too heavily. This is illustrated in the next plot:</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb623-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb623-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">color=</span>continent, <span class="dt">size=</span>pop, <span class="dt">alpha=</span>year)) <span class="op">+</span></a>
<a class="sourceLine" id="cb623-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-266-1.png" width="672" /></p>
<p>As you can see, this is a fancy figure, but also a messy figure. This plot has “information overload,” so we would like to simplify it. To reduce the amount of information, we come back to facets. Be careful with this one as R interprets <code>year</code> as a continuous variable. Use <code>as.factor()</code> or <code>factor()</code> to circumvent this issue,</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb624-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb624-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha=</span><span class="fl">0.65</span>, <span class="kw">aes</span>(<span class="dt">size=</span>pop, <span class="dt">color=</span><span class="kw">as.factor</span>(year))) <span class="op">+</span></a>
<a class="sourceLine" id="cb624-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb624-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-267-1.png" width="672" /></p>
<p>Finally, we can change the labels and text formats. Here, we can save the figure to a .png format. Alternatively, you can save the figure using the Export tab in the Plots viewing panel in RStudio.</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb625-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb625-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha=</span><span class="fl">0.65</span>, <span class="kw">aes</span>(<span class="dt">size=</span>pop, <span class="dt">color=</span>year)) <span class="op">+</span></a>
<a class="sourceLine" id="cb625-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb625-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb625-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;GDP per capita&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Life Expectancy&quot;</span>, <span class="dt">size =</span> <span class="st">&quot;Population&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;Year&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb625-6" data-line-number="6"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st">                           </span><span class="co"># remove the gray background</span></a>
<a class="sourceLine" id="cb625-7" data-line-number="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>))  <span class="co"># make texts larger</span></a>
<a class="sourceLine" id="cb625-8" data-line-number="8"><span class="kw">show</span>(p)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-268-1.png" width="672" /></p>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb626-1" data-line-number="1"><span class="kw">ggsave</span>(<span class="st">&quot;data/08_ggplot2/Life_GDP.png&quot;</span>, <span class="dt">plot =</span> p)</a></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
</div>
<div id="line-plot" class="section level2">
<h2><span class="header-section-number">8.4</span> Line plot</h2>
<p>A line plot is another way to visualize continuous variables. This is particularly useful when</p>
<ol style="list-style-type: decimal">
<li>Your observations change over time and</li>
<li>You want to demonstrate a causal relationship.</li>
</ol>
<p>Let’s elaborate on the second point. In the previous case for life expectancy and GDP, we could only observe a correlation, but cannot conclude a causal relationship. In some case, such as carrying out a laboratory experiment or a simulation study, you can precisely manipulate certain independent variables and measure other dependent variables. This way you can argue for a better causal relationship. For example, you can change the concentration of a drug treatment and measure the inhibition effect.</p>
<p>Let’s take a look at the life expectancy of Africa over the years. Let’s first create a scatter plot.</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb628-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, continent <span class="op">==</span><span class="st"> &quot;Europe&quot;</span>), <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb628-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-269-1.png" width="672" /></p>
<p>Since the points can correspond to the countries, we can connect them with lines.</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb629-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, continent <span class="op">==</span><span class="st"> &quot;Europe&quot;</span>), </a>
<a class="sourceLine" id="cb629-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">colour =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb629-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb629-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-270-1.png" width="672" /></p>
<p>Here the <code>group = country</code> specifies that points with the same values for the variable <code>country</code> should be connected in a line.</p>
<p>Oftentimes you want to show line plots with mean values and error bars. Unfortunately, ggplot2 can’t automatically draw error bars – you have to explicitly specify the values. We’re going to address this in the next example.</p>
<p>First, calculate the mean and SEM and save it to a new data frame.</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb630-1" data-line-number="1">df &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb630-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, continent) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb630-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_le =</span> <span class="kw">mean</span>(lifeExp), <span class="dt">sd=</span><span class="kw">sd</span>(lifeExp), <span class="dt">sem =</span> <span class="kw">sd</span>(lifeExp)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">n</span>()))</a></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;year&#39; (override with `.groups` argument)</code></pre>
<p>Next, draw a line plot with this data frame. To draw error bars, we need to specify the upper and lower limits within <code>geom_errorbar()</code>.</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb632-1" data-line-number="1">lineplot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> mean_le, <span class="dt">color =</span> continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb632-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb632-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb632-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mean_le<span class="op">-</span>sem, <span class="dt">ymax =</span> mean_le<span class="op">+</span>sem),</a>
<a class="sourceLine" id="cb632-5" data-line-number="5">                <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.05</span>))  <span class="co"># position_dodge() sets length of error bar caps</span></a>
<a class="sourceLine" id="cb632-6" data-line-number="6"><span class="kw">show</span>(lineplot)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-272-1.png" width="672" /></p>
<p>Finally, let’s format the figure nicely.</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb633-1" data-line-number="1">lineplot &lt;-<span class="st"> </span>lineplot <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Life Expectancy&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;Continent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb633-2" data-line-number="2"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st">                      </span><span class="co"># remove the gray background</span></a>
<a class="sourceLine" id="cb633-3" data-line-number="3"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>))  <span class="co"># set font size</span></a>
<a class="sourceLine" id="cb633-4" data-line-number="4"><span class="kw">show</span>(lineplot)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-273-1.png" width="672" /></p>
<p>For a cleaner view with offset axis:</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb634-1" data-line-number="1">lineplot &lt;-<span class="st"> </span>lineplot <span class="op">+</span></a>
<a class="sourceLine" id="cb634-2" data-line-number="2"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line =</span> <span class="kw">element_blank</span>(),  <span class="co"># hide the default axes</span></a>
<a class="sourceLine" id="cb634-3" data-line-number="3">        <span class="dt">axis.ticks.length =</span> <span class="kw">unit</span>(<span class="dv">7</span>, <span class="st">&#39;pt&#39;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb634-4" data-line-number="4"><span class="st">  </span><span class="co"># specify the breaks of y-axis</span></a>
<a class="sourceLine" id="cb634-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">40</span>,<span class="dv">80</span>,<span class="dv">20</span>), <span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">35</span>,<span class="dv">85</span>), <span class="dt">expand=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb634-6" data-line-number="6"><span class="st">  </span><span class="co"># specify the breaks of x-axis</span></a>
<a class="sourceLine" id="cb634-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">1950</span>, <span class="dv">2010</span>, <span class="dv">20</span>), <span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">1945</span>,<span class="dv">2010</span>), <span class="dt">expand=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb634-8" data-line-number="8"><span class="st">  </span><span class="co"># specify the location of the new y-axis</span></a>
<a class="sourceLine" id="cb634-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">y=</span><span class="dv">40</span>, <span class="dt">yend=</span><span class="dv">80</span>, <span class="dt">x=</span><span class="dv">1945</span>, <span class="dt">xend=</span><span class="dv">1945</span>, <span class="dt">lwd=</span><span class="fl">0.5</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">lineend=</span><span class="st">&quot;square&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb634-10" data-line-number="10"><span class="st">  </span><span class="co"># specify the location of the new x-axis</span></a>
<a class="sourceLine" id="cb634-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">y=</span><span class="dv">35</span>, <span class="dt">yend=</span><span class="dv">35</span>, <span class="dt">x=</span><span class="dv">1950</span>, <span class="dt">xend=</span><span class="dv">2010</span>, <span class="dt">lwd=</span><span class="fl">0.5</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">lineend=</span><span class="st">&quot;square&quot;</span>)</a>
<a class="sourceLine" id="cb634-12" data-line-number="12"><span class="kw">show</span>(lineplot)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-274-1.png" width="672" /></p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb635-1" data-line-number="1"><span class="kw">ggsave</span>(<span class="st">&quot;data/08_ggplot2/life_year.png&quot;</span>, <span class="dt">plot =</span> lineplot)</a></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
</div>
<div id="bar-plot" class="section level2">
<h2><span class="header-section-number">8.5</span> Bar plot</h2>
<div id="basics" class="section level3">
<h3><span class="header-section-number">8.5.1</span> Basics</h3>
<p>Let’s look at the life expectancy of all continents in 1977 using a bar plot. Notice that instead of using <code>dplyr</code>, we can simply use the base R <code>subset()</code> function. Recall <code>df</code> from the previous section.</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb637-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(df, year <span class="op">==</span><span class="st"> </span><span class="dv">1977</span>), <span class="kw">aes</span>(<span class="dt">x=</span>continent, <span class="dt">y=</span>mean_le)) <span class="op">+</span></a>
<a class="sourceLine" id="cb637-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-275-1.png" width="672" /></p>
<p>Note by default, <code>geom_col</code> takes both x and y while <code>geom_bar</code> takes only x and plots the count on y. Just as before, we can add error bars:</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb638-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(df, year <span class="op">==</span><span class="st"> </span><span class="dv">1977</span>), <span class="kw">aes</span>(<span class="dt">x=</span>continent, <span class="dt">y=</span>mean_le)) <span class="op">+</span></a>
<a class="sourceLine" id="cb638-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb638-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mean_le <span class="op">-</span><span class="st"> </span>sem, <span class="dt">ymax =</span> mean_le <span class="op">+</span><span class="st"> </span>sem), <span class="dt">width=</span><span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb638-4" data-line-number="4">                 <span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">0.05</span>))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-276-1.png" width="672" /></p>
<p>We can compare 1977 and 2007 by setting<code>fill = as.factor(year)</code>.</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb639-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(df, year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1977</span>, <span class="dv">2007</span>)), </a>
<a class="sourceLine" id="cb639-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">x=</span>continent, <span class="dt">y=</span>mean_le, <span class="dt">fill =</span> <span class="kw">as.factor</span>(year))) <span class="op">+</span></a>
<a class="sourceLine" id="cb639-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(), <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb639-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mean_le <span class="op">-</span><span class="st"> </span>sem, <span class="dt">ymax =</span> mean_le <span class="op">+</span><span class="st"> </span>sem), <span class="dt">width=</span><span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb639-5" data-line-number="5">                 <span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">0.9</span>))</a>
<a class="sourceLine" id="cb639-6" data-line-number="6"><span class="kw">show</span>(p)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-277-1.png" width="672" /></p>
<p>Finally, let’s make this figure publication-ready:</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb640-1" data-line-number="1">p &lt;-<span class="st"> </span>p <span class="op">+</span></a>
<a class="sourceLine" id="cb640-2" data-line-number="2"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&#39;black&#39;</span>, <span class="st">&#39;white&#39;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb640-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Continent&#39;</span>, <span class="dt">y=</span><span class="st">&#39;Mean life expectancy (years)&#39;</span>, <span class="dt">fill =</span> <span class="st">&#39;Year&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb640-4" data-line-number="4"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb640-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">16</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb640-6" data-line-number="6"><span class="st">  </span><span class="co"># removes space between bottom of bars and x-axis</span></a>
<a class="sourceLine" id="cb640-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb640-8" data-line-number="8">p</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-278-1.png" width="672" /></p>
</div>
<div id="plotting-significance-optional" class="section level3">
<h3><span class="header-section-number">8.5.2</span> Plotting significance (OPTIONAL)</h3>
<p>Next we can run some statistical tests and add significance stars (*) to the plot. We’ll compare if the life expectancy in Africa in 1977 and 2007 has changed.</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb641-1" data-line-number="1">africa.<span class="fl">1977.</span>lifeExp &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(continent <span class="op">==</span><span class="st"> &#39;Africa&#39;</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">1977</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(lifeExp)</a>
<a class="sourceLine" id="cb641-2" data-line-number="2">africa.<span class="fl">2007.</span>lifeExp &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(continent <span class="op">==</span><span class="st"> &#39;Africa&#39;</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(lifeExp)</a>
<a class="sourceLine" id="cb641-3" data-line-number="3"><span class="kw">t.test</span>(africa.<span class="fl">1977.</span>lifeExp, africa.<span class="fl">2007.</span>lifeExp)</a></code></pre></div>
<pre><code>## 
## 	Welch Two Sample t-test
## 
## data:  africa.1977.lifeExp and africa.2007.lifeExp
## t = -3.195, df = 91.787, p-value = 0.001917
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -8.474086 -1.977145
## sample estimates:
## mean of x mean of y 
##  49.58042  54.80604</code></pre>
<p>The p-value is 0.001917. Here are common ranges for different p-values: 0 **** 0.0001 *** 0.001 ** 0.01 * 0.05 ns 1. We should use ** in this case. To draw the significance stars, we need the <code>ggsignif</code> package.</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb643-1" data-line-number="1"><span class="co"># install.packages(&quot;ggsignif&quot;)</span></a>
<a class="sourceLine" id="cb643-2" data-line-number="2"><span class="kw">library</span>(ggsignif)</a>
<a class="sourceLine" id="cb643-3" data-line-number="3">meanLE.<span class="fl">77.07</span> &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_signif</span>(<span class="dt">y_position =</span> <span class="dv">60</span>, <span class="dt">xmin =</span> <span class="fl">0.75</span>, <span class="dt">xmax =</span> <span class="fl">1.25</span>, <span class="co"># position of the stars</span></a>
<a class="sourceLine" id="cb643-4" data-line-number="4">              <span class="dt">annotations =</span> <span class="st">&quot;**&quot;</span>, <span class="dt">tip_length =</span> <span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb643-5" data-line-number="5">meanLE.<span class="fl">77.07</span></a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-280-1.png" width="672" /></p>
<p>There are more ways to draw the significant stars in R. For example, <code>ggpubr</code> even allows you to run the tests and plot the stars in the same line.</p>
<p>However, I do not encourage you to do so. Manually adding the stars might be a bit tedious (in terms of adjusting the positions and tip length), but you are not as restricted by the package in terms of the tests you can do.</p>
</div>
</div>
<div id="box-plot" class="section level2">
<h2><span class="header-section-number">8.6</span> Box plot</h2>
<p>Box plots are extremely versatile. Here are 2 reasons:</p>
<ol style="list-style-type: decimal">
<li>You don’t need to calculate the mean and error for box plots (remember we used <code>df</code> for bar plots).</li>
<li>Many high-profile journals ask authors to submit graphs that shows not only the statistical description (mean and error), but also the dots for the raw data. Box plots are well suited for this purpose.</li>
</ol>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb644-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1977</span>, <span class="dv">2007</span>)), </a>
<a class="sourceLine" id="cb644-2" data-line-number="2">            <span class="kw">aes</span>(<span class="dt">x =</span> continent, <span class="dt">y =</span> lifeExp, <span class="dt">color =</span> <span class="kw">as.factor</span>(year))) <span class="op">+</span></a>
<a class="sourceLine" id="cb644-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.8</span>))</a>
<a class="sourceLine" id="cb644-4" data-line-number="4"><span class="kw">show</span>(p)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-281-1.png" width="672" /></p>
<p>Let’s add the data points. Here I use <code>geom_jitter</code> to avoid overlapping. Please note that <code>position_jitterdodge</code> introduces random noise to the x position of the points to make it easier to read. But since we are plotting against a categorical variable, the exact x position doesn’t matter.</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb645-1" data-line-number="1">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="kw">position_jitterdodge</span>(<span class="fl">0.4</span>), <span class="dt">alpha =</span> <span class="fl">0.65</span>)</a></code></pre></div>
<p>Use <code>stat_summary</code> show data points and statistics together.</p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb646-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1977</span>, <span class="dv">2007</span>)), </a>
<a class="sourceLine" id="cb646-2" data-line-number="2">            <span class="kw">aes</span>(<span class="dt">x =</span> continent, <span class="dt">y =</span> lifeExp, <span class="dt">color =</span> <span class="kw">as.factor</span>(year))) <span class="op">+</span></a>
<a class="sourceLine" id="cb646-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position =</span> <span class="kw">position_jitterdodge</span>(<span class="fl">0.4</span>), <span class="dt">alpha =</span> <span class="fl">0.65</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb646-4" data-line-number="4"><span class="st">  </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb646-5" data-line-number="5"><span class="st">  </span><span class="co"># adds error bar</span></a>
<a class="sourceLine" id="cb646-6" data-line-number="6"><span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">fun.data=</span>mean_sdl, <span class="dt">fun.args =</span> <span class="kw">list</span>(<span class="dt">mult=</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb646-7" data-line-number="7">        <span class="dt">geom=</span><span class="st">&quot;errorbar&quot;</span>, <span class="dt">width=</span><span class="fl">0.3</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.7</span>), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb646-8" data-line-number="8"><span class="st">  </span><span class="co"># adds mean pooint to the error bar</span></a>
<a class="sourceLine" id="cb646-9" data-line-number="9"><span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">fun=</span>mean, <span class="dt">geom=</span><span class="st">&quot;point&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.7</span>), <span class="dt">size =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb646-10" data-line-number="10"><span class="kw">show</span>(p)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-283-1.png" width="672" /></p>
<p>Add asterisks and format the plot.</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb647-1" data-line-number="1">p &lt;-<span class="st"> </span>p <span class="op">+</span></a>
<a class="sourceLine" id="cb647-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_signif</span>(<span class="dt">y_position =</span> <span class="dv">85</span>, <span class="dt">xmin =</span> <span class="fl">0.75</span>, <span class="dt">xmax =</span> <span class="fl">1.25</span>, <span class="dt">annotations =</span> <span class="st">&quot;**&quot;</span>, <span class="dt">tip_length =</span> <span class="fl">0.02</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb647-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Continents&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Life Expectancy (years)&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;Year&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb647-4" data-line-number="4"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>))  <span class="co"># make text larger</span></a>
<a class="sourceLine" id="cb647-5" data-line-number="5"><span class="kw">show</span>(p)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-284-1.png" width="672" /></p>
<p>We can again offset the axes.</p>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb648-1" data-line-number="1">offset_box &lt;-<span class="st"> </span>p <span class="op">+</span></a>
<a class="sourceLine" id="cb648-2" data-line-number="2"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line =</span> <span class="kw">element_blank</span>(),  <span class="co"># hide the default axes</span></a>
<a class="sourceLine" id="cb648-3" data-line-number="3">        <span class="dt">axis.ticks.length =</span> <span class="kw">unit</span>(<span class="dv">7</span>, <span class="st">&#39;pt&#39;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb648-4" data-line-number="4"><span class="st">  </span><span class="co"># Specify the breaks of y-axis</span></a>
<a class="sourceLine" id="cb648-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">30</span>,<span class="dv">90</span>,<span class="dv">30</span>), <span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">25</span>,<span class="dv">95</span>), <span class="dt">expand=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb648-6" data-line-number="6"><span class="st">  </span><span class="co"># Specify location of x-axis</span></a>
<a class="sourceLine" id="cb648-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">y=</span><span class="dv">30</span>, <span class="dt">yend=</span><span class="dv">90</span>, <span class="dt">x=</span><span class="fl">0.4</span>, <span class="dt">xend=</span><span class="fl">0.4</span>, <span class="dt">lwd=</span><span class="fl">0.5</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">lineend=</span><span class="st">&quot;square&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb648-8" data-line-number="8"><span class="st">  </span><span class="co"># Specify location of y-axis</span></a>
<a class="sourceLine" id="cb648-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">y=</span><span class="dv">25</span>, <span class="dt">yend=</span><span class="dv">25</span>, <span class="dt">x=</span><span class="dv">1</span>, <span class="dt">xend=</span><span class="dv">5</span>, <span class="dt">lwd=</span><span class="fl">0.5</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">lineend=</span><span class="st">&quot;square&quot;</span>)</a>
<a class="sourceLine" id="cb648-10" data-line-number="10"><span class="kw">show</span>(offset_box)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-285-1.png" width="672" /></p>
<p>Now we can save this publication-ready figure.</p>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb649-1" data-line-number="1"><span class="kw">ggsave</span>(<span class="st">&#39;data/08_ggplot2/life_year_jitter.png&#39;</span>, <span class="dt">plot =</span> offset_box)</a></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
</div>
<div id="histogram-and-density-plot" class="section level2">
<h2><span class="header-section-number">8.7</span> Histogram and density plot</h2>
<p>Since these have been covered extensively in previous labs, I’m going to go through this section rather quickly. The histogram and density plot are great tools for looking at distributions of a single variable:</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb651-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>), <span class="kw">aes</span>(<span class="dt">x =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb651-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">fill =</span> <span class="st">&#39;#69B3A2&#39;</span>)</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-287-1.png" width="672" /></p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb653-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>), <span class="kw">aes</span>(<span class="dt">x =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb653-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&#39;#69B3A2&#39;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-287-2.png" width="672" /></p>
<p>We can also use these plots to compare distributions.</p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb654-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb654-2" data-line-number="2"><span class="st">  </span><span class="co"># 2007 data and label</span></a>
<a class="sourceLine" id="cb654-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>),</a>
<a class="sourceLine" id="cb654-4" data-line-number="4">               <span class="kw">aes</span>(<span class="dt">x =</span> lifeExp, <span class="dt">y =</span> ..density..), <span class="dt">fill =</span> <span class="st">&#39;#69B3A2&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb654-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_label</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">40</span>, <span class="dt">y=</span><span class="fl">0.03</span>, <span class="dt">label=</span><span class="st">&#39;2007&#39;</span>), <span class="dt">colour =</span> <span class="st">&#39;#69B3A2&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb654-6" data-line-number="6"><span class="st">  </span><span class="co"># 1977 data and label</span></a>
<a class="sourceLine" id="cb654-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">1977</span>),</a>
<a class="sourceLine" id="cb654-8" data-line-number="8">               <span class="kw">aes</span>(<span class="dt">x =</span> lifeExp, <span class="dt">y =</span> <span class="op">-</span>..density..), <span class="dt">fill =</span> <span class="st">&#39;#404080&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb654-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_label</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">40</span>, <span class="dt">y=</span><span class="op">-</span><span class="fl">0.03</span>, <span class="dt">label=</span><span class="st">&#39;1977&#39;</span>), <span class="dt">colour =</span> <span class="st">&#39;#404080&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb654-10" data-line-number="10"><span class="st">  </span><span class="kw">theme_minimal</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-288-1.png" width="672" /></p>
<p>Perhaps a histogram would be better for our purposes.</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb655-1" data-line-number="1">hist.<span class="fl">07.77</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb655-2" data-line-number="2"><span class="st">  </span><span class="co"># 2007 data and label</span></a>
<a class="sourceLine" id="cb655-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>),</a>
<a class="sourceLine" id="cb655-4" data-line-number="4">                 <span class="kw">aes</span>(<span class="dt">x =</span> lifeExp, <span class="dt">y =</span> ..density..), <span class="dt">fill =</span> <span class="st">&#39;#69B3A2&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb655-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_label</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">40</span>, <span class="dt">y=</span><span class="fl">0.03</span>, <span class="dt">label=</span><span class="st">&#39;2007&#39;</span>), <span class="dt">colour =</span> <span class="st">&#39;#69B3A2&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb655-6" data-line-number="6"><span class="st">  </span><span class="co"># 1977 data and label</span></a>
<a class="sourceLine" id="cb655-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">data =</span> <span class="kw">subset</span>(gapminder, year <span class="op">==</span><span class="st"> </span><span class="dv">1977</span>),</a>
<a class="sourceLine" id="cb655-8" data-line-number="8">                 <span class="kw">aes</span>(<span class="dt">x =</span> lifeExp, <span class="dt">y =</span> <span class="op">-</span>..density..), <span class="dt">fill =</span> <span class="st">&#39;#404080&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb655-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_label</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">40</span>, <span class="dt">y=</span><span class="op">-</span><span class="fl">0.03</span>, <span class="dt">label=</span><span class="st">&#39;1977&#39;</span>), <span class="dt">colour =</span> <span class="st">&#39;#404080&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb655-10" data-line-number="10"><span class="st">  </span><span class="kw">theme_minimal</span>()</a>
<a class="sourceLine" id="cb655-11" data-line-number="11">hist.<span class="fl">07.77</span></a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-289-1.png" width="672" /></p>
</div>
<div id="assembly-of-multiple-figures-optional" class="section level2">
<h2><span class="header-section-number">8.8</span> Assembly of multiple figures (OPTIONAL)</h2>
<p>Many figures in academic journals include multiple subfigures within a figure.</p>
<p>To assemble many graphs into one figure, usually we use a graphical design software such as Illustrator, Inkscape or even PowerPoint.</p>
<p>If you are able to generate all subfigures within one single R script (so that all the <code>ggplot2</code> objects are present together), you could go on to use R package <code>patchwork</code> to assemble them into a big figure.</p>
<p>(Please note that this could be a very rare scenario when conducting serious research - Each subfigures may require intense computation and modelling work that are performed with several scripts. They may even come from different people - your teammates and collaborators. You don’t always have access to all te subfigures within one workspace. Most of the time you would still find yourself using graphical design softwares to assemble the figures.)</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb657-1" data-line-number="1"><span class="co"># install.packages(&#39;patchwork&#39;)</span></a>
<a class="sourceLine" id="cb657-2" data-line-number="2"><span class="kw">library</span>(patchwork)</a></code></pre></div>
<p>Here is a super simple example: just add the plots together! Recall that these variables were saved throughout our lab.</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb658-1" data-line-number="1">hist.<span class="fl">07.77</span> <span class="op">+</span><span class="st"> </span>lineplot</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-291-1.png" width="672" /></p>
<p>We can also do something a bit more complicated:</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb660-1" data-line-number="1">(hist.<span class="fl">07.77</span> <span class="op">+</span><span class="st"> </span>lineplot) <span class="op">/</span><span class="st"> </span>offset_box</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-292-1.png" width="672" /></p>
<p>We can also add spacing between plots:</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb662-1" data-line-number="1">patch &lt;-<span class="st"> </span>(hist.<span class="fl">07.77</span> <span class="op">+</span><span class="st"> </span><span class="kw">plot_spacer</span>() <span class="op">+</span><span class="st"> </span>lineplot) <span class="op">/</span></a>
<a class="sourceLine" id="cb662-2" data-line-number="2"><span class="st">  </span>(meanLE.<span class="fl">77.07</span> <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">12</span>)))</a>
<a class="sourceLine" id="cb662-3" data-line-number="3">patch</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-293-1.png" width="672" /></p>
<p>Most figures in papers are annotated. We can do the same: ‘1’ for Arabic numerals, ‘A’ for uppercase Latin letters, ‘a’ for lowercase Latin letters, ‘I’ for uppercase Roman numerals, and ‘i’ for lowercase Roman numerals. Note here that the sizing</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb664-1" data-line-number="1">(hist.<span class="fl">07.77</span> <span class="op">+</span><span class="st"> </span>lineplot) <span class="op">/</span><span class="st"> </span>(meanLE.<span class="fl">77.07</span> <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">12</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb664-2" data-line-number="2"><span class="st">  </span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&#39;A&#39;</span>)</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-294-1.png" width="672" /></p>
<p>More often than not, we want all of our figures to have the same dimensions. <code>patchwork</code> makes it easy for us to do so:</p>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb666-1" data-line-number="1">aligned_plots &lt;-<span class="st"> </span><span class="kw">align_patches</span>(lineplot, scatter_trend, meanLE.<span class="fl">77.07</span>, offset_box)</a>
<a class="sourceLine" id="cb666-2" data-line-number="2"><span class="cf">for</span> (p <span class="cf">in</span> aligned_plots) {</a>
<a class="sourceLine" id="cb666-3" data-line-number="3">  <span class="kw">plot</span>(p)</a>
<a class="sourceLine" id="cb666-4" data-line-number="4">}</a></code></pre></div>
<p>That’s all there is to it! If you want more customization options, read the official documentation: <a href="https://patchwork.data-imaginist.com/articles/patchwork.html" class="uri">https://patchwork.data-imaginist.com/articles/patchwork.html</a>.</p>
</div>
<div id="extras-optional" class="section level2">
<h2><span class="header-section-number">8.9</span> Extras (OPTIONAL)</h2>
<div id="choropleth" class="section level3">
<h3><span class="header-section-number">8.9.1</span> Choropleth</h3>
<blockquote>
<p>“The greatest value of a picture is when it forces us to notice what we never expected to see.” –John Tukey</p>
</blockquote>
<p><a href="https://datavizcatalogue.com/methods/choropleth.html">The choropleth</a> is used to display differences in geographical regions using different colours/shades/patterns. To use map data, we need to install <code>maps</code> package.</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb667-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;maps&quot;</span>)</a></code></pre></div>
<p>First, let’s load <code>maps</code> and retrieve all of the data from the year 2007.</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb668-1" data-line-number="1"><span class="kw">library</span>(maps)</a>
<a class="sourceLine" id="cb668-2" data-line-number="2">dat2007 &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>)</a>
<a class="sourceLine" id="cb668-3" data-line-number="3">dat2007 &lt;-<span class="st"> </span>dat2007 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="st">&#39;region&#39;</span> =<span class="st"> &#39;country&#39;</span>)</a></code></pre></div>
<p>Now let’s get the world map data. This is necessary because it contains the longitude and latitudes we need to draw the map</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb669-1" data-line-number="1">world_map &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&quot;world&quot;</span>)</a>
<a class="sourceLine" id="cb669-2" data-line-number="2"><span class="kw">head</span>(world_map)</a></code></pre></div>
<pre><code>##        long      lat group order region subregion
## 1 -69.89912 12.45200     1     1  Aruba      &lt;NA&gt;
## 2 -69.89571 12.42300     1     2  Aruba      &lt;NA&gt;
## 3 -69.94219 12.43853     1     3  Aruba      &lt;NA&gt;
## 4 -70.00415 12.50049     1     4  Aruba      &lt;NA&gt;
## 5 -70.06612 12.54697     1     5  Aruba      &lt;NA&gt;
## 6 -70.05088 12.59707     1     6  Aruba      &lt;NA&gt;</code></pre>
<p>Whereas <code>gapminder</code> names USA and UK ‘United States’ and ‘United Kingdom’ respectively, <code>world_map</code> names them by their abbreviations. Let’s rename the <code>gapminder</code> data.</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb671-1" data-line-number="1">dat2007 &lt;-<span class="st"> </span>dat2007 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">region =</span> <span class="kw">fct_recode</span>(region,</a>
<a class="sourceLine" id="cb671-2" data-line-number="2">                             <span class="st">&#39;USA&#39;</span> =<span class="st"> &#39;United States&#39;</span>,</a>
<a class="sourceLine" id="cb671-3" data-line-number="3">                             <span class="st">&#39;UK&#39;</span> =<span class="st"> &#39;United Kingdom&#39;</span>))</a></code></pre></div>
<p>We’re almost there! Now, we need to merge the data.</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb672-1" data-line-number="1">life.exp.map &lt;-<span class="st"> </span><span class="kw">left_join</span>(world_map, dat2007, <span class="dt">by =</span> <span class="st">&quot;region&quot;</span>)</a>
<a class="sourceLine" id="cb672-2" data-line-number="2"><span class="kw">head</span>(life.exp.map)</a></code></pre></div>
<pre><code>##        long      lat group order region subregion continent year lifeExp pop
## 1 -69.89912 12.45200     1     1  Aruba      &lt;NA&gt;      &lt;NA&gt;   NA      NA  NA
## 2 -69.89571 12.42300     1     2  Aruba      &lt;NA&gt;      &lt;NA&gt;   NA      NA  NA
## 3 -69.94219 12.43853     1     3  Aruba      &lt;NA&gt;      &lt;NA&gt;   NA      NA  NA
## 4 -70.00415 12.50049     1     4  Aruba      &lt;NA&gt;      &lt;NA&gt;   NA      NA  NA
## 5 -70.06612 12.54697     1     5  Aruba      &lt;NA&gt;      &lt;NA&gt;   NA      NA  NA
## 6 -70.05088 12.59707     1     6  Aruba      &lt;NA&gt;      &lt;NA&gt;   NA      NA  NA
##   gdpPercap
## 1        NA
## 2        NA
## 3        NA
## 4        NA
## 5        NA
## 6        NA</code></pre>
<p>Finally, we can plot the data. We specify <code>group</code> to draw each country individually.</p>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb674-1" data-line-number="1"><span class="co"># grey means no gapminder data</span></a>
<a class="sourceLine" id="cb674-2" data-line-number="2"><span class="kw">ggplot</span>(life.exp.map, <span class="kw">aes</span>(<span class="dt">x=</span>long, <span class="dt">y=</span>lat, <span class="dt">group =</span> group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb674-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> lifeExp), <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb674-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_fill_viridis_b</span>(<span class="dt">option=</span><span class="st">&#39;D&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb674-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-301-1.png" width="672" /></p>
</div>
<div id="animations" class="section level3">
<h3><span class="header-section-number">8.9.2</span> Animations</h3>
<p>While we covered the most relevant data visualizations for your project, we’ve barely scratched the surface of what R can do. For example, you can create animations. Let’s install the <code>gganimate</code> package.</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb675-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&#39;devtools&#39;</span>)</a>
<a class="sourceLine" id="cb675-2" data-line-number="2">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&#39;thomasp85/gganimate&#39;</span>)</a></code></pre></div>
<p>Next, load the package:</p>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb676-1" data-line-number="1"><span class="kw">library</span>(gganimate)</a></code></pre></div>
<pre><code>## Warning: package &#39;gganimate&#39; was built under R version 3.6.2</code></pre>
<p>Finally, we can create the plot! This might take a while, but I promise it will be worth the wait!</p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb678-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(gdpPercap, lifeExp, <span class="dt">size =</span> pop, <span class="dt">col =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb678-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.7</span>, <span class="dt">show.legend =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb678-3" data-line-number="3"><span class="st">    </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> country_colors) <span class="op">+</span></a>
<a class="sourceLine" id="cb678-4" data-line-number="4"><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb678-5" data-line-number="5"><span class="st">    </span><span class="kw">scale_size</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">12</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb678-6" data-line-number="6"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>continent) <span class="op">+</span></a>
<a class="sourceLine" id="cb678-7" data-line-number="7"><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb678-8" data-line-number="8"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb678-9" data-line-number="9"><span class="st">    </span><span class="co"># here is the animation code</span></a>
<a class="sourceLine" id="cb678-10" data-line-number="10"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Year: {frame_time}&#39;</span>, <span class="dt">x =</span> <span class="st">&#39;GDP per capita&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Life expectancy (years)&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb678-11" data-line-number="11"><span class="st">    </span><span class="kw">transition_time</span>(year) <span class="op">+</span></a>
<a class="sourceLine" id="cb678-12" data-line-number="12"><span class="st">    </span><span class="kw">ease_aes</span>(<span class="st">&#39;linear&#39;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-304-1.gif" /><!-- --></p>
</div>
</div>
<div id="additional-resources" class="section level2">
<h2><span class="header-section-number">8.10</span> Additional resources</h2>
<p>I highly recommend you read through these websites:</p>
<ul>
<li>From Data to Viz: <a href="https://www.data-to-viz.com" class="uri">https://www.data-to-viz.com</a>
<ul>
<li>Includes the visualization and the type of data it corresponds to.</li>
</ul></li>
<li>Patchwork: <a href="https://github.com/thomasp85/patchwork" class="uri">https://github.com/thomasp85/patchwork</a>
<ul>
<li>For creating multi-plot figures.</li>
</ul></li>
<li>Caveats: <a href="https://www.data-to-viz.com/caveats.html" class="uri">https://www.data-to-viz.com/caveats.html</a>
<ul>
<li>Pitfalls to avooid when creating figures.</li>
</ul></li>
<li>The Python Graph Gallery: <a href="https://python-graph-gallery.com" class="uri">https://python-graph-gallery.com</a>
<ul>
<li>If you’re more comfortable with Python. Includes the visualization and code to creat it.</li>
</ul></li>
</ul>
<div class="figure">
<img src="data/08_ggplot2/data_to_vis.png" alt="Data visualizations for various data types. Check out https://www.data-to-viz.com/ for an interactive version of this chart!" />
<p class="caption">Data visualizations for various data types. Check out <a href="https://www.data-to-viz.com/" class="uri">https://www.data-to-viz.com/</a> for an interactive version of this chart!</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="comparing-multiple-means.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
